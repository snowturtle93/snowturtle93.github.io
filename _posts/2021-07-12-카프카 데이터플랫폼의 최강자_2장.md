---
title: "카프카 데이터플랫폼의 최강자 2장"
author: Kang HyunGu
date: 2021-07-13 20:36:00 +0900
categories: [기술서적, 카프카데이터플랫폼의최강자]
tags: [기술서적]
toc: true
pin: true
comments: true
---
게임 데이터 실시간 처리를 위해 Kafka의 구조와 개발 방법을 익히기 위해 팀원과 스터디를 진행하기로해 앞으로 블로그에 책의 내용을 정리 요약하여 발표할 계획이다.
우선 2장은 카프카 설치에 관한 내용으로 간단히 진행해 보기로한다.
## 0.kafka의 간단한 구성도
<p align="center"><img src="{{site.url}}/img/posts/카프카 데이터플랫폼의 최강자 2장/kafka_architecture.png" width="600" height="400"></p>
위의 그림처럼 Kafka는 Apache Zookeeper를 코디네이션 어플리케이션으로 사용하는데 Kafka를 설치하기전 Zookeeper에대해 간단히 알아보고 시작한다.

## 1. Kafka 관리를 위한 주키퍼
주키퍼는 본래 하둡의 서브 프로젝트중 하나였지만, 2011년 1월 부터 아파치 탑 레벨 프로젝트로 승격되었고 현재는 Kafka뿐만 아니라 Storm, Hbase, NiFi등 많은 어플리케이션에서 사용중이다.<br/>
주키퍼는 분산 어플리케이션을 위한 코디네이션 시스템으로 분산되어 있는 각 어플리케이션의 정보를 중앙에 집중하고 구성 관리, 그룹 관리 네이밍, 동기화 등의 서비스를 제공한다.<br/>
하둡에서 주키퍼는 노드들의 상태를 관리하고 Active 네임노드가 죽으면 Stanby 네임노드를 Active로 바꿔주는 HA 구성에도 필요하다.
<p align="center"><img src="{{site.url}}/img/posts/카프카 데이터플랫폼의 최강자 2장/zookeeper_architecture.jpeg" width="600" height="400"></p>
주키퍼 서비스 (출처:https://zookeeper.apache.org/doc/r3.7.0/zookeeperOver.html)<br/>
위의 그림처럼 주키퍼는 서버 여러대를 클러스터로 구성하고 분산 어플리케이션들이 각각 클라이언트가 되어 주키퍼 서버들과 커넥션을 맺어 상태 정보등을 주고 받는다.
이때 상태 정보들은 주키퍼의 znode에 키 밸류 형태로 저장되고 znode에 키값이 저장된것을 이용하여 분산 어플리케이션들이 서로의 데이터를 주고 받게 된다.
주키퍼에서 사용되는 znode는 데이터를 저장하기 위한 공간으로 일반 컴퓨터의 파일이나 폴더 개념이라고 생각하면 된다.<br/>
일반적으로 znode에 저장되는 데이터 크기는 바이트에서 킬로바이트로 매우 작지만 모든 데이터는 메모리에 저장하기 떄문에 jvm의 heap memory를 모든 znode를 올릴 수 있는 충분한 크기로 만들어야 한다. <br/>
또한 아래 그림 처럼 디렉토리와 비슷한 구조로 자식노드를 가지고있는 계층형 구조로 되어있다.
<p align="center"><img src="{{site.url}}/img/posts/카프카 데이터플랫폼의 최강자 2장/zknamespace.jpeg" width="600" height="400"></p>
주키퍼 네임 스페이스 구조 (출처:https://zookeeper.apache.org/doc/r3.7.0/zookeeperOver.html)<br/>
주키퍼의 지노드는 데이터 변경 등에 대한 유효성 검사를 위해 버전 번호를 관리하며 데이터가 변경될 때마다 지노드의 버전 번호가 증가하게 된다.
앙상블(클러스터)로 구성되어 있는 주키퍼는 노드가 과반수 이상 유지된다면 지속적인 서비스가 가능하다.
이 내용을 보면 주키퍼는 홀수로 구성하는게 효율이 좋을것으로 예상된다.<br/>
또한 아래 그래프를 보면 노드수에 비해 꾀나 선형적으로 데이터 처리량이 증가하는것을 보인다.
<p align="center"><img src="{{site.url}}/img/posts/카프카 데이터플랫폼의 최강자 2장/zkperfRW-3.2.jpg" width="600" height="400"></p>
주키퍼 서버당 처리량 (출처:https://zookeeper.apache.org/doc/r3.7.0/zookeeperOver.html)<br/>
